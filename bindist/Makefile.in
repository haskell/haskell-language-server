DESTDIR ?=
PREFIX ?= /usr/local
LIBDIR ?= $(PREFIX)/lib
BINDIR ?= $(PREFIX)/bin

HLS_VERSION := @@HLS_VERSION@@

INSTALL := install
SED     := sed
CHMOD   := chmod
LN      := ln

install:
	$(INSTALL) -d $(BINDIR)
	$(INSTALL) -d $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/lib
	$(INSTALL) -d $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/bin
	for f in $(wildcard lib/*/*) ; do \
		$(INSTALL) -d $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/ ; \
		$(INSTALL) -vm 755 $$f $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/$$f ; \
	done
	for b in $(wildcard bin/*) ; do \
		$(INSTALL) -d $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/ ; \
		$(INSTALL) -vm 755 $$b $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/$$b ; \
	done
	for h in $(wildcard haskell-language-server-*) ; do \
		$(SED) -e "s#@@EXE_DIR@@#$(LIBDIR)/haskell-language-server-$(HLS_VERSION)/bin/#" \
			$$h > $(BINDIR)/$$h ; \
		$(CHMOD) 755 $(BINDIR)/$$h ; \
	done
	$(LN) -s `scripts/relpath.sh "\`realpath $(BINDIR)\`" "\`realpath $(LIBDIR)/haskell-language-server-$(HLS_VERSION)/bin/haskell-language-server-wrapper\`"` \
		$(BINDIR)/haskell-language-server-wrapper

version:
	@echo $(HLS_VERSION)

.PHONY: install
